<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Neural closure models · IncompressibleNavierStokes.jl</title><meta name="title" content="Neural closure models · IncompressibleNavierStokes.jl"/><meta property="og:title" content="Neural closure models · IncompressibleNavierStokes.jl"/><meta property="twitter:title" content="Neural closure models · IncompressibleNavierStokes.jl"/><meta name="description" content="Documentation for IncompressibleNavierStokes.jl."/><meta property="og:description" content="Documentation for IncompressibleNavierStokes.jl."/><meta property="twitter:description" content="Documentation for IncompressibleNavierStokes.jl."/><meta property="og:url" content="https://agdestein.github.io/IncompressibleNavierStokes.jl/features/closure/"/><meta property="twitter:url" content="https://agdestein.github.io/IncompressibleNavierStokes.jl/features/closure/"/><link rel="canonical" href="https://agdestein.github.io/IncompressibleNavierStokes.jl/features/closure/"/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.svg" alt="IncompressibleNavierStokes.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">IncompressibleNavierStokes.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><a class="tocitem" href="../../getting_started/">Getting Started</a></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../../generated/LidDrivenCavity2D/">Tutorial: Lid-Driven Cavity (2D)</a></li><li><a class="tocitem" href="../../generated/TaylorGreenVortex2D/">Convergence: Taylor-Green Vortex (2D)</a></li><li><a class="tocitem" href="../../generated/Actuator2D/">Unsteady inflow: Actuator (2D)</a></li><li><a class="tocitem" href="../../generated/BackwardFacingStep2D/">Walls: Backward Facing Step (2D)</a></li><li><a class="tocitem" href="../../generated/DecayingTurbulence2D/">Decaying Turbulunce (2D)</a></li><li><a class="tocitem" href="../../generated/PlanarMixing2D/">Planar Mixing (2D)</a></li></ul></li><li><span class="tocitem">Equations</span><ul><li><a class="tocitem" href="../../equations/ns/">Incompressible Navier-Stokes equations</a></li><li><a class="tocitem" href="../../equations/spatial/">Spatial discretization</a></li><li><a class="tocitem" href="../../equations/time/">Time discretization</a></li></ul></li><li><span class="tocitem">Features</span><ul><li><a class="tocitem" href="../bc/">Boundary conditions</a></li><li><a class="tocitem" href="../pressure/">Pressure solvers</a></li><li><a class="tocitem" href="../precision/">Floating point precision</a></li><li><a class="tocitem" href="../gpu/">GPU Support</a></li><li><a class="tocitem" href="../operators/">Operators</a></li><li><a class="tocitem" href="../temperature/">Temperature equation</a></li><li><a class="tocitem" href="../les/">Large eddy simulation</a></li><li class="is-active"><a class="tocitem" href>Neural closure models</a><ul class="internal"><li><a class="tocitem" href="#NeuralClosure-module"><span>NeuralClosure module</span></a></li><li><a class="tocitem" href="#Training"><span>Training</span></a></li><li><a class="tocitem" href="#Neural-architectures"><span>Neural architectures</span></a></li></ul></li></ul></li><li><span class="tocitem">API Reference</span><ul><li><a class="tocitem" href="../../api/api/">API</a></li><li><a class="tocitem" href="../../api/tableaux/">Runge-Kutta methods</a></li></ul></li><li><a class="tocitem" href="../../references/">References</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Features</a></li><li class="is-active"><a href>Neural closure models</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Neural closure models</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/agdestein/IncompressibleNavierStokes.jl/blob/main/docs/src/features/closure.md#" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Neural-closure-models"><a class="docs-heading-anchor" href="#Neural-closure-models">Neural closure models</a><a id="Neural-closure-models-1"></a><a class="docs-heading-anchor-permalink" href="#Neural-closure-models" title="Permalink"></a></h1><div class="admonition is-info"><header class="admonition-header">`NeuralClorusure`</header><div class="admonition-body"><p>These features are experimental, and require cloning IncompressibleNavierStokes from GitHub:</p><pre><code class="language-sh hljs">git clone https://github.com/agdestein/IncompressibleNavierStokes.jl
cd IncompressibleNavierStokes/lib/NeuralClosure</code></pre></div></div><p>For <a href="../les/">large eddy simulation (LES)</a>, a closure model is required. With IncompressibleNavierStokes, a neural closure model can be trained on filtered DNS data. The discrete DNS equations are given by</p><p class="math-container">\[\begin{split}
M u &amp; = 0, \\
\frac{\mathrm{d} u}{\mathrm{d} t} &amp; = F(u) - G p.
\end{split}\]</p><p>Applying a spatial filter <span>$\Phi$</span>, the extracted large scale components <span>$\bar{u} = \Phi u$</span> are governed by the equation</p><p class="math-container">\[\begin{split}
M \bar{u} &amp; = 0, \\
\frac{\mathrm{d} \bar{u}}{\mathrm{d} t} &amp; = F(\bar{u}) + c - G \bar{p},
\end{split}\]</p><p>where the discretizations <span>$M$</span>, <span>$F$</span>, and <span>$G$</span> are adapted to the size of their inputs and <span>$c = \overline{F(u)} - F(\bar{u})$</span> is a commutator error. We here assumed that <span>$M$</span> and <span>$\Phi$</span> commute, which is the case for face averaging filters. Replacing <span>$c$</span> with a parameterized closure model <span>$m(\bar{u}, \theta) \approx c$</span> gives the LES equations for the approximate large scale velocity <span>$\bar{v} \approx \bar{u}$</span></p><p class="math-container">\[\begin{split}
M \bar{v} &amp; = 0, \\
\frac{\mathrm{d} \bar{v}}{\mathrm{d} t} &amp; = F(\bar{v}) + m(\bar{v}, \theta) - G \bar{q}.
\end{split}\]</p><h2 id="NeuralClosure-module"><a class="docs-heading-anchor" href="#NeuralClosure-module">NeuralClosure module</a><a id="NeuralClosure-module-1"></a><a class="docs-heading-anchor-permalink" href="#NeuralClosure-module" title="Permalink"></a></h2><p>IncompressibleNavierStokes provides a NeuralClosure module.</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="NeuralClosure.NeuralClosure" href="#NeuralClosure.NeuralClosure"><code>NeuralClosure.NeuralClosure</code></a> — <span class="docstring-category">Module</span></header><section><div><p>Neural closure modelling tools.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/agdestein/IncompressibleNavierStokes.jl/blob/75220556334ac559dd93aa0d2fecabfd181eb947/lib/NeuralClosure/src/NeuralClosure.jl#L1-L3">source</a></section></article><p>The following filters are available:</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="NeuralClosure.FaceAverage" href="#NeuralClosure.FaceAverage"><code>NeuralClosure.FaceAverage</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">(::FaceAverage)(v, u, setup_les)</code></pre><p>Average fine grid <code>u</code> over coarse volume face. Put result in <code>v</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/agdestein/IncompressibleNavierStokes.jl/blob/75220556334ac559dd93aa0d2fecabfd181eb947/lib/NeuralClosure/src/filter.jl#L13-L17">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="NeuralClosure.VolumeAverage" href="#NeuralClosure.VolumeAverage"><code>NeuralClosure.VolumeAverage</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">(::VolumeAverage)(v, u, setup_les, comp)</code></pre><p>Average fine grid <code>u</code> over coarse volume. Put result in <code>v</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/agdestein/IncompressibleNavierStokes.jl/blob/75220556334ac559dd93aa0d2fecabfd181eb947/lib/NeuralClosure/src/filter.jl#L81-L85">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="NeuralClosure.reconstruct!" href="#NeuralClosure.reconstruct!"><code>NeuralClosure.reconstruct!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">reconstruct!(u, v, setup_dns, setup_les)</code></pre><p>Average fine grid <code>u</code> over coarse volume face. Put result in <code>v</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/agdestein/IncompressibleNavierStokes.jl/blob/75220556334ac559dd93aa0d2fecabfd181eb947/lib/NeuralClosure/src/filter.jl#L41-L45">source</a></section></article><p>The following functions create data.</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="NeuralClosure.filtersaver" href="#NeuralClosure.filtersaver"><code>NeuralClosure.filtersaver</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">filtersaver(dns, les, filters, compression, psolver_dns, psolver_les; nupdate = 1)</code></pre><p>Save filtered DNS data.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/agdestein/IncompressibleNavierStokes.jl/blob/75220556334ac559dd93aa0d2fecabfd181eb947/lib/NeuralClosure/src/create_les_data.jl#L60-L64">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="NeuralClosure.create_les_data" href="#NeuralClosure.create_les_data"><code>NeuralClosure.create_les_data</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">create_les_data(
    D = 2,
    Re = 2e3,
    lims = ntuple(α -&gt; (typeof(Re)(0), typeof(Re)(1)), D),
    nles = [ntuple(α -&gt; 64, D)],
    ndns = ntuple(α -&gt; 256, D),
    filters = (FaceAverage(),),
    tburn = typeof(Re)(0.1),
    tsim = typeof(Re)(0.1),
    Δt = typeof(Re)(1e-4),
    create_psolver = psolver_spectral,
    savefreq = 1,
    ArrayType = Array,
    icfunc = (setup, psolver) -&gt; random_field(setup, typeof(Re)(0); psolver),
    rng,
    kwargs...,
)</code></pre><p>Create filtered DNS data.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/agdestein/IncompressibleNavierStokes.jl/blob/75220556334ac559dd93aa0d2fecabfd181eb947/lib/NeuralClosure/src/create_les_data.jl#L94-L114">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="NeuralClosure.create_io_arrays" href="#NeuralClosure.create_io_arrays"><code>NeuralClosure.create_io_arrays</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">create_io_arrays(data, setups)</code></pre><p>Create <span>$(\bar{u}, c)$</span> pairs for training.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/agdestein/IncompressibleNavierStokes.jl/blob/75220556334ac559dd93aa0d2fecabfd181eb947/lib/NeuralClosure/src/create_les_data.jl#L223-L227">source</a></section></article><h2 id="Training"><a class="docs-heading-anchor" href="#Training">Training</a><a id="Training-1"></a><a class="docs-heading-anchor-permalink" href="#Training" title="Permalink"></a></h2><p>To improve the model parameters, we exploit exact filtered DNS data <span>$\bar{u}$</span> and exact commutator errors <span>$c$</span> obtained through DNS. The model is trained by minimizing the a priori loss function</p><p class="math-container">\[L^\text{prior}(\theta) = \| m(\bar{u}, \theta) - c \|^2,\]</p><p>or the a posteriori loss function</p><p class="math-container">\[L^\text{post}(\theta) = \| \bar{v}_\theta - \bar{u} \|^2,\]</p><p>where <span>$\bar{v}_\theta$</span> is the solution to the LES equation for the given parameters <span>$\theta$</span>. The prior loss is easy to evaluate and easy to differentiate, as it does not involve solving the ODE. However, minimizing <span>$L^\text{prior}$</span> does not take into account the effect of the prediction error on the LES solution error. The posterior loss does, but has a longer computational chain involving solving the LES ODE.</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="NeuralClosure.create_dataloader_prior" href="#NeuralClosure.create_dataloader_prior"><code>NeuralClosure.create_dataloader_prior</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">createdataloader(data; nuse = 50, device = identity, rng)</code></pre><p>Create dataloader that uses a batch of <code>batchsize</code> random samples from <code>data</code> at each evaluation. The batch is moved to <code>device</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/agdestein/IncompressibleNavierStokes.jl/blob/75220556334ac559dd93aa0d2fecabfd181eb947/lib/NeuralClosure/src/training.jl#L1-L7">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="NeuralClosure.create_dataloader_post" href="#NeuralClosure.create_dataloader_post"><code>NeuralClosure.create_dataloader_post</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">create_dataloader_post(trajectories; nunroll = 10, device = identity, rng)</code></pre><p>Create trajectory dataloader.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/agdestein/IncompressibleNavierStokes.jl/blob/75220556334ac559dd93aa0d2fecabfd181eb947/lib/NeuralClosure/src/training.jl#L19-L23">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="NeuralClosure.train" href="#NeuralClosure.train"><code>NeuralClosure.train</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">train(
    dataloaders,
    loss,
    opt,
    θ;
    niter = 100,
    ncallback = 1,
    callback = (i, θ) -&gt; println(&quot;Iteration $i of $niter&quot;),
)</code></pre><p>Update parameters <code>θ</code> to minimize <code>loss(dataloader(), θ)</code> using the optimiser <code>opt</code> for <code>niter</code> iterations.</p><p>Return the a new named tuple <code>(; opt, θ, callbackstate)</code> with updated state and parameters.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/agdestein/IncompressibleNavierStokes.jl/blob/75220556334ac559dd93aa0d2fecabfd181eb947/lib/NeuralClosure/src/training.jl#L34-L50">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="NeuralClosure.create_loss_prior" href="#NeuralClosure.create_loss_prior"><code>NeuralClosure.create_loss_prior</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">createloss_prior(loss, f)</code></pre><p>Wrap loss function <code>loss(batch, θ)</code>.</p><p>The function <code>loss</code> should take inputs like <code>loss(f, x, y, θ)</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/agdestein/IncompressibleNavierStokes.jl/blob/75220556334ac559dd93aa0d2fecabfd181eb947/lib/NeuralClosure/src/training.jl#L74-L80">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="NeuralClosure.create_relerr_prior" href="#NeuralClosure.create_relerr_prior"><code>NeuralClosure.create_relerr_prior</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">create_relerr_prior(f, x, y)</code></pre><p>Create a-priori error.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/agdestein/IncompressibleNavierStokes.jl/blob/75220556334ac559dd93aa0d2fecabfd181eb947/lib/NeuralClosure/src/training.jl#L83-L87">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="NeuralClosure.mean_squared_error" href="#NeuralClosure.mean_squared_error"><code>NeuralClosure.mean_squared_error</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">mean_squared_error(f, x, y, θ; normalize = y -&gt; sum(abs2, y), λ = sqrt(eps(eltype(x))))</code></pre><p>Compute MSE between <code>f(x, θ)</code> and <code>y</code>.</p><p>The MSE is further divided by <code>normalize(y)</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/agdestein/IncompressibleNavierStokes.jl/blob/75220556334ac559dd93aa0d2fecabfd181eb947/lib/NeuralClosure/src/training.jl#L90-L96">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="NeuralClosure.create_loss_post" href="#NeuralClosure.create_loss_post"><code>NeuralClosure.create_loss_post</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">create_loss_post(;
    setup,
    method = RKMethods.RK44(; T = eltype(setup.grid.x[1])),
    psolver,
    closure,
    nupdate = 1,
    projectorder = :last,
)</code></pre><p>Create a-posteriori loss function.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/agdestein/IncompressibleNavierStokes.jl/blob/75220556334ac559dd93aa0d2fecabfd181eb947/lib/NeuralClosure/src/training.jl#L100-L111">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="NeuralClosure.create_relerr_post" href="#NeuralClosure.create_relerr_post"><code>NeuralClosure.create_relerr_post</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">create_relerr_post(;
    data,
    setup,
    method = RKMethods.RK44(; T = eltype(setup.grid.x[1])),
    psolver,
    closure_model,
    nupdate = 1,
)</code></pre><p>Create a-posteriori relative error.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/agdestein/IncompressibleNavierStokes.jl/blob/75220556334ac559dd93aa0d2fecabfd181eb947/lib/NeuralClosure/src/training.jl#L146-L157">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="NeuralClosure.create_callback" href="#NeuralClosure.create_callback"><code>NeuralClosure.create_callback</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">create_callback(
    f,
    x,
    y;
    state = Point2f[],
    display_each_iteration = false,
)</code></pre><p>Create convergence plot for relative error between <code>f(x, θ)</code> and <code>y</code>. At each callback, plot is updated and current error is printed.</p><p>If <code>state</code> is nonempty, it also plots previous convergence.</p><p>If not using interactive GLMakie window, set <code>display_each_iteration</code> to <code>true</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/agdestein/IncompressibleNavierStokes.jl/blob/75220556334ac559dd93aa0d2fecabfd181eb947/lib/NeuralClosure/src/training.jl#L196-L212">source</a></section></article><h2 id="Neural-architectures"><a class="docs-heading-anchor" href="#Neural-architectures">Neural architectures</a><a id="Neural-architectures-1"></a><a class="docs-heading-anchor-permalink" href="#Neural-architectures" title="Permalink"></a></h2><p>We provide two neural architectures: A convolutional neural network (CNN) and a Fourier neural operator (FNO).</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="NeuralClosure.wrappedclosure" href="#NeuralClosure.wrappedclosure"><code>NeuralClosure.wrappedclosure</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">wrappedclosure(m, setup)</code></pre><p>Wrap closure model and parameters so that it can be used in the solver.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/agdestein/IncompressibleNavierStokes.jl/blob/75220556334ac559dd93aa0d2fecabfd181eb947/lib/NeuralClosure/src/closure.jl#L1-L5">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="NeuralClosure.create_closure" href="#NeuralClosure.create_closure"><code>NeuralClosure.create_closure</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">create_closure(layers...; rng)</code></pre><p>Create neural closure model from layers.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/agdestein/IncompressibleNavierStokes.jl/blob/75220556334ac559dd93aa0d2fecabfd181eb947/lib/NeuralClosure/src/closure.jl#L34-L38">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="NeuralClosure.create_tensorclosure" href="#NeuralClosure.create_tensorclosure"><code>NeuralClosure.create_tensorclosure</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">create_tensorclosure(layers...; setup, rng)</code></pre><p>Create tensor basis closure.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/agdestein/IncompressibleNavierStokes.jl/blob/75220556334ac559dd93aa0d2fecabfd181eb947/lib/NeuralClosure/src/closure.jl#L52-L56">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="NeuralClosure.collocate" href="#NeuralClosure.collocate"><code>NeuralClosure.collocate</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">collocate(u)</code></pre><p>Interpolate velocity components to volume centers.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/agdestein/IncompressibleNavierStokes.jl/blob/75220556334ac559dd93aa0d2fecabfd181eb947/lib/NeuralClosure/src/closure.jl#L68-L72">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="NeuralClosure.decollocate" href="#NeuralClosure.decollocate"><code>NeuralClosure.decollocate</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">decollocate(u)</code></pre><p>Interpolate closure force from volume centers to volume faces.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/agdestein/IncompressibleNavierStokes.jl/blob/75220556334ac559dd93aa0d2fecabfd181eb947/lib/NeuralClosure/src/closure.jl#L101-L105">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="NeuralClosure.cnn" href="#NeuralClosure.cnn"><code>NeuralClosure.cnn</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">cnn(;
    setup,
    radii,
    channels,
    activations,
    use_bias,
    channel_augmenter = identity,
    rng = Random.default_rng(),
)</code></pre><p>Create CNN closure model. Return a tuple <code>(closure, θ)</code> where <code>θ</code> are the initial parameters and <code>closure(u, θ)</code> predicts the commutator error.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/agdestein/IncompressibleNavierStokes.jl/blob/75220556334ac559dd93aa0d2fecabfd181eb947/lib/NeuralClosure/src/cnn.jl#L1-L14">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="NeuralClosure.fno" href="#NeuralClosure.fno"><code>NeuralClosure.fno</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">fno(; setup, kmax, c, σ, ψ, rng = Random.default_rng(), kwargs...)</code></pre><p>Create FNO closure model. Return a tuple <code>(closure, θ)</code> where <code>θ</code> are the initial parameters and <code>closure(V, θ)</code> predicts the commutator error.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/agdestein/IncompressibleNavierStokes.jl/blob/75220556334ac559dd93aa0d2fecabfd181eb947/lib/NeuralClosure/src/fno.jl#L1-L6">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="NeuralClosure.FourierLayer" href="#NeuralClosure.FourierLayer"><code>NeuralClosure.FourierLayer</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">FourierLayer(dimension, kmax, cin =&gt; cout; σ = identity, init_weight = glorot_uniform)</code></pre><p>Fourier layer operating on uniformly discretized functions.</p><p>Some important sizes:</p><ul><li><code>dimension</code>: Spatial dimension, e.g. <code>Dimension(2)</code> or <code>Dimension(3)</code>.</li><li><code>(nx..., cin, nsample)</code>: Input size</li><li><code>(nx..., cout, nsample)</code>: Output size</li><li><code>nx = fill(n, dimension())</code>: Number of points in each spatial dimension</li><li><code>n ≥ kmax</code>: Same number of points in each spatial dimension, must be larger than cut-off wavenumber</li><li><code>kmax</code>: Cut-off wavenumber</li><li><code>nsample</code>: Number of input samples (treated independently)</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/agdestein/IncompressibleNavierStokes.jl/blob/75220556334ac559dd93aa0d2fecabfd181eb947/lib/NeuralClosure/src/fno.jl#L49-L64">source</a></section></article></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../les/">« Large eddy simulation</a><a class="docs-footer-nextpage" href="../../api/api/">API »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.4.1 on <span class="colophon-date" title="Monday 6 May 2024 23:11">Monday 6 May 2024</span>. Using Julia version 1.10.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
