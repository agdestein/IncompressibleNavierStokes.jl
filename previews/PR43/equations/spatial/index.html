<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Spatial discretization · IncompressibleNavierStokes.jl</title><meta name="title" content="Spatial discretization · IncompressibleNavierStokes.jl"/><meta property="og:title" content="Spatial discretization · IncompressibleNavierStokes.jl"/><meta property="twitter:title" content="Spatial discretization · IncompressibleNavierStokes.jl"/><meta name="description" content="Documentation for IncompressibleNavierStokes.jl."/><meta property="og:description" content="Documentation for IncompressibleNavierStokes.jl."/><meta property="twitter:description" content="Documentation for IncompressibleNavierStokes.jl."/><meta property="og:url" content="https://agdestein.github.io/IncompressibleNavierStokes.jl/equations/spatial/"/><meta property="twitter:url" content="https://agdestein.github.io/IncompressibleNavierStokes.jl/equations/spatial/"/><link rel="canonical" href="https://agdestein.github.io/IncompressibleNavierStokes.jl/equations/spatial/"/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.svg" alt="IncompressibleNavierStokes.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">IncompressibleNavierStokes.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><a class="tocitem" href="../../getting_started/">Getting Started</a></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../../generated/LidDrivenCavity2D/">Tutorial: Lid-Driven Cavity (2D)</a></li><li><a class="tocitem" href="../../generated/TaylorGreenVortex2D/">Convergence: Taylor-Green Vortex (2D)</a></li></ul></li><li><span class="tocitem">Equations</span><ul><li><a class="tocitem" href="../ns/">Incompressible Navier-Stokes equations</a></li><li class="is-active"><a class="tocitem" href>Spatial discretization</a><ul class="internal"><li><a class="tocitem" href="#Finite-volumes"><span>Finite volumes</span></a></li><li><a class="tocitem" href="#Interpolation"><span>Interpolation</span></a></li><li><a class="tocitem" href="#Finite-volume-discretization-of-the-Navier-Stokes-equations"><span>Finite volume discretization of the Navier-Stokes equations</span></a></li><li><a class="tocitem" href="#Boundary-conditions"><span>Boundary conditions</span></a></li><li><a class="tocitem" href="#Fourth-order-accurate-discretization"><span>Fourth order accurate discretization</span></a></li><li><a class="tocitem" href="#Matrix-representation"><span>Matrix representation</span></a></li><li><a class="tocitem" href="#Discrete-pressure-Poisson-equation"><span>Discrete pressure Poisson equation</span></a></li><li><a class="tocitem" href="#Discrete-output-quantities"><span>Discrete output quantities</span></a></li><li><a class="tocitem" href="#Stream-function"><span>Stream function</span></a></li></ul></li><li><a class="tocitem" href="../time/">Time discretization</a></li></ul></li><li><span class="tocitem">Features</span><ul><li><a class="tocitem" href="../../features/bc/">Boundary conditions</a></li><li><a class="tocitem" href="../../features/pressure/">Pressure solvers</a></li><li><a class="tocitem" href="../../features/precision/">Floating point precision</a></li><li><a class="tocitem" href="../../features/gpu/">GPU Support</a></li><li><a class="tocitem" href="../../features/operators/">Operators</a></li><li><a class="tocitem" href="../../features/les/">Large eddy simulation</a></li><li><a class="tocitem" href="../../features/closure/">Neural closure models</a></li></ul></li><li><span class="tocitem">API Reference</span><ul><li><a class="tocitem" href="../../api/api/">API</a></li><li><a class="tocitem" href="../../api/tableaux/">Runge-Kutta methods</a></li></ul></li><li><a class="tocitem" href="../../references/">References</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Equations</a></li><li class="is-active"><a href>Spatial discretization</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Spatial discretization</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/agdestein/IncompressibleNavierStokes.jl/blob/main/docs/src/equations/spatial.md#" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Spatial-Discretization"><a class="docs-heading-anchor" href="#Spatial-Discretization">Spatial Discretization</a><a id="Spatial-Discretization-1"></a><a class="docs-heading-anchor-permalink" href="#Spatial-Discretization" title="Permalink"></a></h1><p>To discretize the incompressible Navier-Stokes equations, we will use finite volumes on a staggered Cartesian grid, as proposed by Harlow and Welsh [<a href="../../references/#Harlow1965">1</a>]. We will use the notation of Sanderse [<a href="../../references/#Sanderse2012">2</a>] [<a href="../../references/#Sanderse2013">3</a>] [<a href="../../references/#Sanderse2014">4</a>].</p><p>Let <span>$d \in \{2, 3\}$</span> denote the spatial dimension (2D or 3D). We will make use of the &quot;Cartesian&quot; index <span>$I = (i, j)$</span> in 2D or <span>$I = (i, j, k)$</span> in 3D, with <span>$I(1) = i$</span>, <span>$I(2) = j$</span>, and <span>$I(3) = k$</span>. Here, the indices <span>$I$</span>, <span>$i$</span>, <span>$j$</span>, and <span>$k$</span>, represent discrete degrees of freedom, and can take integer or half values (e.g. <span>$3$</span> or <span>$5/2$</span>). To specify a spatial dimension, we will use the symbols <span>$(\alpha, \beta, \gamma) \in \{1, \dots, d\}^3$</span>. We will use the symbol <span>$\delta(\alpha) = (\delta_{\alpha \beta})_{\beta = 1}^d \in \{0, 1\}^d$</span> to indicate a perturbation in the direction <span>$\alpha$</span>, where <span>$\delta_{\alpha \beta}$</span> is the Kronecker symbol. The spatial variable is <span>$x = (x^1, \dots, x^d) \in \Omega \subset \mathbb{R}^d$</span>.</p><h2 id="Finite-volumes"><a class="docs-heading-anchor" href="#Finite-volumes">Finite volumes</a><a id="Finite-volumes-1"></a><a class="docs-heading-anchor-permalink" href="#Finite-volumes" title="Permalink"></a></h2><p>We here assume that <span>$\Omega = \prod_{\alpha = 1}^d [0, L^\alpha]$</span> has the shape of a box with side lengths <span>$L^\alpha &gt; 0$</span>. This allows for partitioning <span>$\Omega$</span> into the finite volumes</p><p class="math-container">\[\Omega_I = \prod_{\alpha = 1}^d \left[ x^\alpha_{I(\alpha) - \frac{1}{2}},
x^\alpha_{I(\alpha) + \frac{1}{2}} \right], \quad I \in \mathcal{I}.\]</p><p>Just like <span>$\Omega$</span> itself, they represent rectangles in 2D and prisms n 3D. They are fully defined by the vectors of volume face coordinates <span>$x^\alpha = \left( x^\alpha_{i} \right)_{i = 0}^{N(\alpha)} \in \mathbb{R}^{N(\alpha) + 1}$</span>, where <span>$N = (N(1), \dots, N(d)) \in \mathbb{N}^d$</span> are the numbers of finite volumes in each dimension and <span>$\mathcal{I} = \prod_{\alpha = 1}^d \left\{ \frac{1}{2}, 2 - \frac{1}{2}, \dots, N(\alpha) - \frac{1}{2} \right\}$</span> the set of finite volume indices (note that the reference volumes are indexed by half indices only). The components <span>$x^\alpha_{i}$</span> are not assumed to be uniformly spaced. But we do assume that they are strictly increasing with <span>$i$</span>, with <span>$x^\alpha_0 = 0$</span> and <span>$x^\alpha_{N(\alpha)} = L^\alpha$</span>.</p><p>The coordinates of the volume centers are determined from the those of the volume boundaries by <span>$x^\alpha_{I(\alpha)} = \frac{1}{2} (x^\alpha_{I(\alpha) - \frac{1}{2}} + x_{I(\alpha) + \frac{1}{2}})$</span> for <span>$I \in \mathcal{I}$</span>. This allows for defining shifted volumes such as <span>$\Omega_{I + \delta(\alpha) / 2}$</span> and <span>$\Omega_{I + \delta(\alpha) / 2 + \delta(\beta) / 2}$</span>. The original volumes (with indices in <span>$\mathcal{I}$</span>) will be referred to as the reference finite volumes.</p><p>We also define the volume widths/depths/heights <span>$\Delta x^\alpha_i = x^\alpha_{i + \frac{1}{2}} - x^\alpha_{i - \frac{1}{2}}$</span>, where <span>$i$</span> can take half values. The volume sizes are thus <span>$| \Omega_{I} | = \prod_{\alpha = 1}^d \Delta x^\alpha_{I(\alpha)}$</span>. In addition to the finite volumes and their shifted variants, we define the interface <span>$\Gamma^\alpha_I = \Omega_{I - \delta(\alpha) / 2} \cup \Omega_{I + \delta(\alpha) / 2}$</span>.</p><p>In each reference finite volume <span>$\Omega_{I}$</span> (<span>$I \in \mathcal{I}$</span>), there are three different types of positions in which quantities of interest can be defined:</p><ul><li>The volume center <span>$x_I = (x_{I(1)}, \dots, x_{I(d)})$</span>, where the discrete pressure <span>$p_I$</span> is defined;</li><li>The right/rear/top volume face centers <span>$x_{I + \delta(\alpha) / 2}$</span>, where the discrete <span>$\alpha$</span>-velocity component <span>$u^\alpha_{I + \delta(\alpha) / 2}$</span> is defined;</li><li>The right-rear-top volume corner  <span>$x_{I + \sum_{\alpha} \delta(\alpha) / 2}$</span>, where the discrete vorticity <span>$\omega_{I + \sum_{\alpha} \delta(\alpha) / 2}$</span> is defined.</li></ul><p>The vectors of unknowns <span>$u^\alpha_h$</span> and <span>$p_h$</span> will not contain all the half-index components, only those from their own canonical position. The unknown discrete pressure represents the average pressure in each reference volume, and the unknown discrete velocity components represent exchange of mass between neighboring volumes.</p><p>In 2D, this finite volume configuration is illustrated as follows:</p><p><img src="../../assets/grid.png" alt="Grid"/></p><h2 id="Interpolation"><a class="docs-heading-anchor" href="#Interpolation">Interpolation</a><a id="Interpolation-1"></a><a class="docs-heading-anchor-permalink" href="#Interpolation" title="Permalink"></a></h2><p>When a quantity is required <em>outside</em> of its native point, we will use interpolation. Examples:</p><ul><li>To compute <span>$u^\alpha$</span> at the pressure point <span>$x_I$</span>, <span>$I \in \mathcal{I}$</span>:<p class="math-container">\[\begin{split}
    u^\alpha_I &amp; = \frac{x^\alpha_{I(\alpha) + 1 / 2} -
    x^\alpha_{I(\alpha)}}{x^\alpha_{I(\alpha) + 1 / 2} - x^\alpha_{I(\alpha) - 1 / 2}}
    u_{I - \delta(\alpha) / 2}
    + \frac{x^\alpha_{I(\alpha)} - x^\alpha_{I(\alpha) - 1 / 2}}{x^\alpha_{I(\alpha) + 1 / 2} - x^\alpha_{I(\alpha) - 1 / 2}}
    u_{I + \delta(\alpha) / 2} \\
    &amp; = \frac{1}{2} \left( u_{I - \delta(\alpha) / 2} + u_{I + \delta(\alpha) / 2} \right).
\end{split}\]</p>Interpolation weights from volume faces to volume centers are always <span>$\frac{1}{2}$</span>.</li><li>To compute <span>$u^\alpha$</span> at center of edge between <span>$\alpha$</span>-face and <span>$\beta$</span>-face <span>$x_{I + \delta(\alpha) / 2 + \delta(\beta) / 2}$</span>:<p class="math-container">\[u^\alpha_{I + \delta(\alpha) / 2 + \delta(\beta) / 2} =
\frac{x^\beta_{I(\beta) + 1} - x^\beta_{I(\beta) + 1 / 2}}{x^\beta_{I(\beta) + 1} - x^\beta_{I(\beta)}}
u^\alpha_{I + \delta(\alpha) / 2}
+ \frac{x^\beta_{I(\beta) + 1 / 2} - x^\beta_{I(\beta)}}{x^\beta_{I(\beta) + 1} - x^\beta_{I(\beta)}}
u^\alpha_{I + \delta(\alpha) / 2 + \delta(\beta)}.\]</p>Note that the grid is allowed to be non-uniform, so the interpolation weights may unequal and different from <span>$\frac{1}{2}$</span>.</li><li>To compute <span>$p$</span> at <span>$u^\alpha$</span>-points:<p class="math-container">\[p_{I + \delta(\alpha) / 2} =
\frac{x^\alpha_{I(\alpha) + 1} - x^\alpha_{I(\alpha) + 1 / 2}}{x^\alpha_{I(\alpha) + 1} - x^\alpha_{I(\alpha)}}
p_{I}
+ \frac{x^\alpha_{I(\alpha) + 1 / 2} - x^\alpha_{I(\alpha)}}{x^\alpha_{I(\alpha) + 1} - x^\alpha_{I(\alpha)}}
p_{I + \delta(\alpha)}\]</p></li></ul><h2 id="Finite-volume-discretization-of-the-Navier-Stokes-equations"><a class="docs-heading-anchor" href="#Finite-volume-discretization-of-the-Navier-Stokes-equations">Finite volume discretization of the Navier-Stokes equations</a><a id="Finite-volume-discretization-of-the-Navier-Stokes-equations-1"></a><a class="docs-heading-anchor-permalink" href="#Finite-volume-discretization-of-the-Navier-Stokes-equations" title="Permalink"></a></h2><p>We will consider the integral form of the Navier-Stokes equations. This has the advantage that some of the spatial derivatives disappear, reducing the amount of finite difference approximations we need to perform.</p><p>We define the finite difference operator <span>$\partial_\alpha$</span> equivalent to the continuous operator <span>$\frac{\partial}{\partial x^\alpha}$</span>. For all fields discrete fields <span>$\varphi$</span>, it is given by</p><p class="math-container">\[(\partial_\alpha \varphi)_I = \frac{\varphi_{I + \delta(\alpha) / 2} - \varphi_{I -
\delta(\alpha) / 2}}{\Delta^\alpha_{I(\alpha)}},\]</p><p>where <span>$\varphi$</span> is interpolated first if necessary.</p><h3 id="Mass-equation"><a class="docs-heading-anchor" href="#Mass-equation">Mass equation</a><a id="Mass-equation-1"></a><a class="docs-heading-anchor-permalink" href="#Mass-equation" title="Permalink"></a></h3><p>The mass equation takes the form</p><p class="math-container">\[\frac{1}{| \mathcal{O} |}
\int_{\partial \mathcal{O}} u \cdot n \, \mathrm{d} \Gamma = 0,
\quad \forall \mathcal{O} \subset \Omega.\]</p><p>Using the pressure volume <span>$\mathcal{O} = \Omega_{I}$</span>, we get</p><p class="math-container">\[\sum_{\alpha = 1}^d
\frac{1}{| \Omega_I |}
\left( \int_{\Gamma^\alpha_{I + \delta(\alpha) / 2}}
u^\alpha \, \mathrm{d} \Gamma - \int_{\Gamma_{I - \delta(\alpha) / 2}^\alpha}
u^\alpha \, \mathrm{d} \Gamma
\right) = 0.\]</p><p>Assuming that the flow is fully resolved, meaning that <span>$\Omega_{I}$</span> is is sufficiently small such that <span>$u$</span> is locally linear, we can perform the local approximation (quadrature)</p><p class="math-container">\[\int_{\Gamma^\alpha_I} u^\alpha \, \mathrm{d} \Gamma \approx | \Gamma^\alpha_I
| u^\alpha_{I}.\]</p><p>This yields the discrete mass equation</p><p class="math-container">\[\sum_{\alpha = 1}^d (\partial_\alpha u^\alpha)_{I} = 0.\]</p><div class="admonition is-info"><header class="admonition-header">Approximation error</header><div class="admonition-body"><p>For the mass equation, the only approximation we have performed is quadrature. No interpolation or finite difference error is present.</p></div></div><h3 id="Momentum-equations"><a class="docs-heading-anchor" href="#Momentum-equations">Momentum equations</a><a id="Momentum-equations-1"></a><a class="docs-heading-anchor-permalink" href="#Momentum-equations" title="Permalink"></a></h3><p>Grouping the convection, pressure gradient, diffusion, and body force terms in each of their own integrals, we get, for all <span>$\mathcal{O} \subset \Omega$</span>:</p><p class="math-container">\[\begin{split}
\frac{\mathrm{d}}{\mathrm{d} t}
\frac{1}{| \mathcal{O} |}
\int_\mathcal{O} u^\alpha \, \mathrm{d} \Omega
=
&amp; - \sum_{\beta = 1}^d
\frac{1}{| \mathcal{O} |}
\int_{\partial \mathcal{O}}
u^\alpha u^\beta n^\beta
\, \mathrm{d} \Gamma \\
&amp; + \nu \sum_{\beta = 1}^d
\frac{1}{| \mathcal{O} |}
\int_{\partial \mathcal{O}}
\frac{\partial u^\alpha}{\partial x^\beta} n^\beta
\, \mathrm{d} \Gamma \\
&amp; + \frac{1}{| \mathcal{O} |}
\int_\mathcal{O} f^\alpha \mathrm{d} \Omega \\
&amp; - \frac{1}{| \mathcal{O} |}
\int_{\partial \mathcal{O}} p n^\alpha \, \mathrm{d} \Gamma,
\end{split}\]</p><p>where <span>$n = (n^1, \dots, n^d)$</span> is the surface normal vector to <span>$\partial \mathcal{O}$</span>.</p><p>This time, we will not let <span>$\mathcal{O}$</span> be the reference finite volume <span>$\Omega_{I}$</span> (the <span>$p$</span>-volume), but rather the shifted <span>$u^\alpha$</span>-volume. Setting <span>$\mathcal{O} = \Omega_{I + \delta(\alpha) / 2}$</span> (with right/rear/top <span>$\beta$</span>-faces <span>$\Gamma^\beta_{I + \delta(\alpha) / 2 + \delta(\beta) / 2}$</span>) gives</p><p class="math-container">\[\begin{split}
    \frac{\mathrm{d}}{\mathrm{d} t}
    \frac{1}{| \Omega_{I + \delta(\alpha) / 2} |}
    \int_{\Omega_{I + \delta(\alpha) / 2}}
    \! \! \! 
    \! \! \! 
    \! \! \! 
    \! \! \! 
    u^\alpha \, \mathrm{d} \Omega
    =
    &amp; -
    \sum_{\beta = 1}^d
    \frac{1}{| \Omega_{I + \delta(\alpha) / 2} |}
    \left(
        \int_{\Gamma^{\beta}_{I + \delta(\alpha) / 2 + \delta(\beta) / 2}}
            \! \! \! 
            \! \! \! 
            \! \! \! 
            \! \! \! 
        u^\alpha u^\beta \, \mathrm{d} \Gamma 
        - \int_{\Gamma^{\beta}_{I + \delta(\alpha) / 2 - \delta(\beta) / 2}}
            \! \! \! 
            \! \! \! 
            \! \! \! 
            \! \! \! 
            \! \! \! 
            \! \! \! 
        u^\alpha u^\beta \, \mathrm{d} \Gamma 
    \right) \\
    &amp; + \nu \sum_{\beta = 1}^d 
    \frac{1}{| \Omega_{I + \delta(\alpha) / 2} |}
    \left(
        \int_{\Gamma^{\beta}_{I + \delta(\alpha) / 2 + \delta(\beta) / 2}}
        \frac{\partial u^\alpha}{\partial x^\beta} \, \mathrm{d} \Gamma 
        - \int_{\Gamma^{\beta}_{I + \delta(\alpha) / 2 - \delta(\beta) / 2}}
        \frac{\partial u^\alpha}{\partial x^\beta} \, \mathrm{d} \Gamma 
    \right) \\
    &amp; +
    \frac{1}{| \Omega_{I + \delta(\alpha) / 2} |}
    \int_{\Omega_{I + \delta(\alpha) / 2}}
    f^\alpha \, \mathrm{d} \Omega \\
    &amp; -
    \frac{1}{| \Omega_{I + \delta(\alpha) / 2} |}
    \left(
        \int_{\Gamma^{\alpha}_{I + \delta(\alpha)}} p \, \mathrm{d} \Gamma -
        \int_{\Gamma^{\alpha}_{I}} p \, \mathrm{d} \Gamma
    \right).
\end{split}\]</p><p>This equation is still exact. We now introduce some approximations on <span>$\Omega_{I + \delta(\alpha) / 2}$</span> and its boundaries to remove all unknown continuous quantities.</p><ol><li>We replace the integrals with a mid-point quadrature rule.</li><li>The mid-point values of derivatives are approximated using a central-like finite difference:<p class="math-container">\[\frac{\partial u^\alpha}{\partial x^\beta}(x_I) \approx (\partial_\beta u^\alpha)_I\]</p></li><li>Quantities outside their canonical positions are obtained through interpolation.</li></ol><p>Finally, the discrete <span>$\alpha$</span>-momentum equations are given by</p><p class="math-container">\[\begin{split}
    \frac{\mathrm{d} }{\mathrm{d} t} u^\alpha_{I + \delta(\alpha) / 2} =
    - &amp; \sum_{\beta = 1}^d
    (\partial_\beta (u^\alpha u^\beta))_{I + \delta(\alpha) / 2} \\
    + &amp; \nu \sum_{\beta = 1}^d
    (\partial_\beta \partial_\beta u^\alpha)_{I + \delta(\alpha) / 2} \\
    + &amp; f^\alpha(x_{I + \delta(\alpha) / 2}, t)
    - (\partial_\alpha p)_{I + \delta(\alpha) / 2}.
\end{split}\]</p><h2 id="Boundary-conditions"><a class="docs-heading-anchor" href="#Boundary-conditions">Boundary conditions</a><a id="Boundary-conditions-1"></a><a class="docs-heading-anchor-permalink" href="#Boundary-conditions" title="Permalink"></a></h2><p>Depending on the type of boundary conditions, certain indices used in the left- and right hand sides of the equations may not be part of the solution vectors, even if they are indeed at their canonical positions. Consider for example the <span>$\alpha$</span>-left/front/bottom boundary <span>$\{ x \in \Omega | x^{\alpha} = x^\alpha_{0} \}$</span>. Let <span>$\Omega_I$</span> be one of the reference finite volumes touching this boundary, i.e. <span>$I(\alpha) = \frac{1}{2}$</span>.</p><ul><li>For periodic boundary conditions, we also consider the opposite boundary. We add two &quot;ghost&quot; reference volumes, one at each side of <span>$\Omega$</span>:<ol><li>The ghost volume <span>$\Omega_{I - \delta(\alpha)}$</span> has the same shape as <span>$\Omega_{I + (N(\alpha) - 1) \delta(\alpha)}$</span> and contains the same components:<ul><li><span>$u^\alpha_{I - \delta(\alpha) / 2} = u^\alpha_{I + (N(\alpha) - 1 / 2) \delta(\alpha)}$</span>,</li><li><span>$u^\beta_{I + \delta(\beta) / 2 - \delta(\alpha)} = u^\beta_{I + \delta(\beta) / 2 + N(\alpha) \delta(\alpha)}$</span> for <span>$\beta \neq \alpha$</span>,</li><li><span>$p_{I - \delta(\alpha)} = p_{I + (N(\alpha) - 1) \delta(\alpha)}$</span>.</li></ul></li><li>The ghost volume <span>$\Omega_{I + N(\alpha) \delta(\alpha)}$</span> has the same  shape as <span>$\Omega_I$</span> and contains the same pressure and velocity components.</li></ol></li><li>For Dirichlet boundary conditions, all the veloctity components are prescribed. For the normal velocity component, this is straightforward:<p class="math-container">\[u^\alpha_{I - \delta(\alpha) / 2} = u^\alpha(x_{I - \delta(\alpha) / 2}).\]</p>The parallel (<span>$\beta \neq \alpha$</span>) velocity components <span>$u^\beta_{I + \delta(\beta) / 2 - \delta(\alpha)}$</span> appear in some of the right hand side expressions. Their <span>$\alpha$</span> position <span>$x^\alpha_{- 1 / 2}$</span> has actually never been defined, so we simply define it to be on the boundary itself: <span>$x^\alpha_{- 1 / 2} = x^\alpha_0$</span>. The value can then be prescribed:<p class="math-container">\[u^\beta_{I + \delta(\beta) / 2 - \delta(\alpha)} = u^\beta \left( x_{I +
\delta(\beta) / 2 - \delta(\alpha)} \right) = u^\beta \left( x_{I +
\delta(\beta) / 2 - \delta(\alpha) / 2} \right).\]</p>The pressure does not require any boundary modifications.</li><li>For a symmetric boundary, the normal component has zero Dirichlet conditions, while the parallel components have zero Neumann conditions. For this, we add a ghost volume <span>$\Omega_{I - \delta(\alpha)}$</span> which has the same shape as <span>$\Omega_{I}$</span>, meaning that <span>$x^\alpha_{-1} = x^\alpha_0 - (x^\alpha_1 - x^\alpha_0) = - x^\alpha_1$</span>. The pressure in this volume is never used, but we set <span>$u^\alpha_{I - \delta(\alpha) / 2} = 0$</span> and <span>$u^\beta_{I + \delta(\beta) / 2 - \delta(\alpha)} = u^\beta_{I + \delta(\beta) / 2}$</span> for <span>$\beta \neq \alpha$</span>.</li><li>For a pressure boundary, the value of the pressure is prescribed, while the velocity has zero Neumann boundary conditions. For this, we add an infinitely thin ghost volume <span>$\Omega_{I - \delta(\alpha)}$</span>, by setting <span>$x^\alpha_{-1} = x^\alpha_0 - \epsilon$</span> for some epsilon. We then let this thickness go to zero <em>after</em> substituting the boundary conditions in the momentum equations. The pressure is prescribed by<p class="math-container">\[p_{I - \delta(\alpha)} = p(x_{I - \delta(\alpha)}) \underset{\epsilon \to 0}{\to} p(x_{I - \delta(\alpha) / 2}).\]</p>The Neumann boundary conditions are obtained by setting <span>$u^\alpha_{I - 3 / 2 \delta(\alpha)} = u^\alpha_{I - \delta(\alpha) / 2}$</span> and <span>$u^\beta_{I - \delta(\alpha) + \delta(\beta) / 2} = u^\beta_{I + \delta(\beta) / 2}$</span> for <span>$\beta \neq \alpha$</span>. Note that the normal velocity component at the boundary <span>$u^\alpha_{I - \delta(\alpha) / 2}$</span> is now a degree of freedom, and we need to observe that the first normal derivative in the diffusion term of its corresponding momentum equation is zero before taking the limit as <span>$\epsilon \to 0$</span>, to avoid dividing by zero.</li></ul><p>It should now be clear from the above cases which components of the discrete velocity and pressure are unknown degrees of freedom, and which components are prescribed or obtained otherwise. The <em>unknown</em> degrees of freedom are stored in the vectors <span>$u_h = (u^1_h, \dots, u^d_h)$</span> and <span>$p_h$</span> using the column-major convention. Note that the <span>$d$</span> discrete velocity fields <span>$u^1_h, \dots u^d_h$</span> may have different numbers of elements.</p><div class="admonition is-info"><header class="admonition-header">Storage convention</header><div class="admonition-body"><p>We use the column-major convention (Julia, MATLAB, Fortran), and not the row-major convention (Python, C). Thus the <span>$x^1$</span>-index <span>$i$</span> will vary for one whole cycle in the vectors before the <span>$x^2$</span>-index <span>$j$</span>, <span>$x^3$</span> index <span>$k$</span>, and component-index <span>$\alpha$</span> are incremented, e.g. <span>$u_h = (u^1_{(1, 1, 1)}, u^1_{(2, 1, 1)}, \dots u^3_{(N_{u^3}(1), N_{u^3}(2), N_{u^3}(3))})$</span> in 3D.</p></div></div><h2 id="Fourth-order-accurate-discretization"><a class="docs-heading-anchor" href="#Fourth-order-accurate-discretization">Fourth order accurate discretization</a><a id="Fourth-order-accurate-discretization-1"></a><a class="docs-heading-anchor-permalink" href="#Fourth-order-accurate-discretization" title="Permalink"></a></h2><p>The above discretization is second order accurate. A fourth order accurate discretization can be obtained by judiciously combining the second order discretization with itself on a grid with three times larger cells in each dimension [<a href="../../references/#Verstappen2003">5</a>] [<a href="../../references/#Sanderse2014">4</a>]. The coarse discretization is identical, but the mass equation is derived for the three times coarser control volume</p><p class="math-container">\[\Omega^3_I =
\bigcup_{\alpha = 1}^d \Omega_{I - \delta(\alpha)} \cup
\Omega_I \cup \Omega_{I + \delta(\alpha)},\]</p><p>while the momentum equation is derived for its shifted variant <span>$\Omega^3_{I + \delta(\alpha) / 2}$</span>. The resulting fourth order accurate equations are given by</p><p class="math-container">\[\sum_{\alpha = 1}^d
(\partial_\alpha u^\alpha)_I
-
\frac{| \Omega^3_I |}{3^{2 + d} | \Omega_I |}
\sum_{\alpha = 1}^d
(\partial^3_\alpha u^\alpha)_I
= 0\]</p><p>and</p><p class="math-container">\[\begin{split}
    \frac{\mathrm{d} }{\mathrm{d} t} u^\alpha_{I + \delta(\alpha) / 2} =
    - &amp; \sum_{\beta = 1}^d
    (\partial_\beta (u^\alpha u^\beta))_{I + \delta(\alpha) / 2} \\
    + &amp; \nu \sum_{\beta = 1}^d
    (\partial_\beta \partial_\beta u^\alpha)_{I + \delta(\alpha) / 2} \\
    + &amp; f^\alpha(x_{I + \delta(\alpha) / 2}, t)
    - (\partial_\alpha p)_{I + \delta(\alpha) / 2}, \\
    + &amp; \text{fourth order}
\end{split}\]</p><p>where</p><p class="math-container">\[(\partial^3_\alpha \varphi)_I =
\frac{\varphi_{I + 3 \delta(\alpha) / 2} -
\varphi_{I - 3 \delta(\alpha) / 2}}{\Delta^\alpha_{I(\alpha) - 1} +
\Delta^\alpha_{I(\alpha)} + \Delta^\alpha_{I(\alpha) + 1}}.\]</p><h2 id="Matrix-representation"><a class="docs-heading-anchor" href="#Matrix-representation">Matrix representation</a><a id="Matrix-representation-1"></a><a class="docs-heading-anchor-permalink" href="#Matrix-representation" title="Permalink"></a></h2><p>We can write the mass and momentum equations in matrix form. We will use the same matrix notation for the second- and fourth order accurate discretizations. The discrete mass equation becomes</p><p class="math-container">\[M u_h + y_M = 0,\]</p><p>where <span>$M$</span> is the discrete divergence operator and <span>$y_M$</span> contains the boundary value contributions of the velocity to the divergence field.</p><p>The discrete momentum equations become</p><p class="math-container">\[\begin{split}
    \frac{\mathrm{d} u_h}{\mathrm{d} t} &amp; = -C(u_h) + \nu (D u_h +
    y_D) + f_h - (G p_h + y_G) \\
    &amp; = F(u_h) - (G p_h + y_G),
\end{split}\]</p><p>where <span>$C$</span> is she convection operator (including boundary contributions), <span>$D$</span> is the diffusion operator, <span>$y_D$</span> is boundary contribution to the diffusion term, <span>$G = W_u^{-1} M^\mathsf{T} W$</span> is the pressure gradient operator, <span>$y_G$</span> contains the boundary contribution of the pressure to the pressure gradient (only non-zero for pressure boundary conditions), <span>$W_u$</span> is a diagonal matrix containing the velocity volume sizes <span>$| \Omega_{I + \delta(\alpha) / 2} |$</span>, and <span>$W$</span> is a diagonal matrix containing the reference volume sizes <span>$| \Omega_I |$</span>. The term <span>$F$</span> refers to all the forces except for the pressure gradient.</p><div class="admonition is-info"><header class="admonition-header">Volume normalization</header><div class="admonition-body"><p>All the operators have been divided by the velocity volume sizes. As a result, the operators have the same units as their continuous counterparts.</p></div></div><h2 id="Discrete-pressure-Poisson-equation"><a class="docs-heading-anchor" href="#Discrete-pressure-Poisson-equation">Discrete pressure Poisson equation</a><a id="Discrete-pressure-Poisson-equation-1"></a><a class="docs-heading-anchor-permalink" href="#Discrete-pressure-Poisson-equation" title="Permalink"></a></h2><p>Instead of directly discretizing the continuous pressure Poisson equation, we will rededuce it in the <em>discrete</em> setting, thus aiming to preserve the discrete divergence freeness instead of the continuous one. Applying the discrete divergence operator <span>$M$</span> to the discrete momentum equations yields the discrete pressure Poisson equation</p><p class="math-container">\[L p_h = W M (F(u_h) - y_G) + W \frac{\mathrm{d} y_M}{\mathrm{d} t},\]</p><p>where <span>$L = W M G = W M W_u^{-1} M^\mathsf{T} W$</span> is a discrete Laplace operator. It is positive symmetric.</p><div class="admonition is-info"><header class="admonition-header">Unsteady Dirichlet boundary conditions</header><div class="admonition-body"><p>If the equations are prescribed with unsteady Dirichlet boundary conditions, for example an inflow that varies with time, the term <span>$\frac{\mathrm{d} y_M}{\mathrm{d} t}$</span> will be non-zero. If this term is not known exactly, for example if the next value of the inflow is unknown at the time of the current value, it must be computed using past values of of the velocity inflow only, for example <span>$\frac{\mathrm{d} y_M}{\mathrm{d} t} \approx (y_M(t) - y_M(t - \Delta t)) / \Delta t$</span> for some <span>$\Delta t$</span>.</p></div></div><div class="admonition is-info"><header class="admonition-header">Uniqueness of pressure field</header><div class="admonition-body"><p>Unless pressure boundary conditions are present, the pressure is only determined up to a constant, as <span>$L$</span> will have an eigenvalue of zero. Since only the gradient of the pressure appears in the equations, we can set the unknown constant to zero without affecting the velocity field.</p></div></div><div class="admonition is-info"><header class="admonition-header">Pressure projection</header><div class="admonition-body"><p>The pressure field <span>$p_h$</span> can be seen as a Lagrange multiplier enforcing the constraint of discrete divergence freeness. It is also possible to write the momentum equations without the pressure by explicitly solving the discrete Poisson equation:</p><p class="math-container">\[p_h = L^{-1} W M (F(u_h) - y_G) + L^{-1} W \frac{\mathrm{d} y_M}{\mathrm{d} t}.\]</p><p>The momentum equations then become</p><p class="math-container">\[\frac{\mathrm{d} u_h}{\mathrm{d} t} = (I - G L^{-1} W M)
(F(u_h) - y_G) - G L^{-1} W \frac{\mathrm{d} y_M}{\mathrm{d} t}.\]</p><p>The matrix <span>$(I - G L^{-1} W M)$</span> is a projector onto the space of discretely divergence free velocities. However, using this formulation would require an efficient way to perform the projection without assembling the operator matrix <span>$L^{-1}$</span>, which would be very costly.</p></div></div><h2 id="Discrete-output-quantities"><a class="docs-heading-anchor" href="#Discrete-output-quantities">Discrete output quantities</a><a id="Discrete-output-quantities-1"></a><a class="docs-heading-anchor-permalink" href="#Discrete-output-quantities" title="Permalink"></a></h2><h3 id="Kinetic-energy"><a class="docs-heading-anchor" href="#Kinetic-energy">Kinetic energy</a><a id="Kinetic-energy-1"></a><a class="docs-heading-anchor-permalink" href="#Kinetic-energy" title="Permalink"></a></h3><p>The local kinetic energy is defined by <span>$k = \frac{1}{2} \| u \|_2^2 = \frac{1}{2} \sum_{\alpha = 1}^d u^\alpha u^\alpha$</span>. On the staggered grid however, the different velocity components are not located at the same point. We will therefore interpolate the velocity to the pressure point before summing the squares.</p><h3 id="Vorticity"><a class="docs-heading-anchor" href="#Vorticity">Vorticity</a><a id="Vorticity-1"></a><a class="docs-heading-anchor-permalink" href="#Vorticity" title="Permalink"></a></h3><p>In 2D, the vorticity is a scalar. Integrating the vorticity <span>$\omega = -\frac{\partial u^1}{\partial x^2} + \frac{\partial u^2}{\partial x^1}$</span> over the vorticity volume <span>$\Omega_{I + \delta(1) / 2 + \delta(2) / 2}$</span> gives</p><p class="math-container">\[\begin{split}
\int_{\Omega_{I + \delta(1) / 2 + \delta(2) / 2}} \omega \, \mathrm{d} \Omega
= &amp; - \left(
\int_{\Gamma^2_{I + \delta(1) / 2 + \delta(2)}} u^1 \, \mathrm{d} \Gamma
- \int_{\Gamma^2_{I + \delta(1) / 2}} u^1 \, \mathrm{d} \Gamma
\right) \\
&amp; + \left(
\int_{\Gamma^1_{I + \delta(1) + \delta(2) / 2}} u^2 \, \mathrm{d} \Gamma
- \int_{\Gamma^1_{I + \delta(2) / 2}} u^2 \, \mathrm{d} \Gamma
\right)
\end{split}.\]</p><p>Using quadrature, and dividing by the vorticity volume <span>$| \Omega_{I + \delta(1) / 2 + \delta(2) / 2} |$</span>, the discrete vorticity in the corner is given by</p><p class="math-container">\[\omega_{I + \delta(1) / 2 + \delta(2) / 2} =
- \frac{u^1_{I + \delta(1) / 2 + \delta(2)} -
u^1_{I + \delta(1) / 2}}{\Delta^2_{I(2) + 1 / 2}}
+ \frac{u^2_{I + \delta(1) + \delta(2) / 2} -
u^2_{I + \delta(2) / 2}}{\Delta^1_{I(1) + 1 / 2}}.\]</p><p>The 3D vorticity is a vector field <span>$(\omega^1, \omega^2, \omega^3)$</span>. Noting <span>$\alpha^+ = \operatorname{mod}_3(\alpha + 1)$</span> and <span>$\alpha^- = \operatorname{mod}_3(\alpha - 1)$</span>, the vorticity is obtained through</p><p class="math-container">\[\begin{split}
\int_{\Omega_{I + \delta(\alpha^+) / 2 + \delta(\alpha^-) / 2}} \omega \, \mathrm{d} \Omega
= &amp; - \left(
\int_{\Gamma^{\alpha^-}_{I + \delta(\alpha^+) / 2 + \delta(\alpha^-)}} u^{\alpha^+} \, \mathrm{d} \Gamma
- \int_{\Gamma^{\alpha^-}_{I + \delta(\alpha^+) / 2}} u^{\alpha^+} \, \mathrm{d} \Gamma
\right) \\
&amp; + \left(
\int_{\Gamma^{\alpha^+}_{I + \delta(\alpha^+) + \delta(\alpha^-) / 2}} u^{\alpha^-} \, \mathrm{d} \Gamma
- \int_{\Gamma^{\alpha^+}_{I + \delta(\alpha^-) / 2}} u^{\alpha^-} \, \mathrm{d} \Gamma
\right)
\end{split}.\]</p><p>Using quadrature, and dividing by the vorticity volume <span>$| \Omega_{I + \delta(\alpha^+) / 2 + \delta(\alpha^-) / 2} |$</span>, the discrete vorticity around the <span>$\alpha$</span>-edge is given by</p><p class="math-container">\[\omega_{I + \delta(\alpha^+) / 2 + \delta(\alpha^-) / 2} =
- \frac{u^{\alpha^+}_{I + \delta(\alpha^+) / 2 + \delta(\alpha^-)} -
u^{\alpha^+}_{I + \delta(\alpha^+) / 2}}{\Delta^{\alpha^-}_{I(\alpha^-) + 1 / 2}}
+ \frac{u^{\alpha^-}_{I + \delta(\alpha^+) + \delta(\alpha^-) / 2} -
u^{\alpha^-}_{I + \delta(\alpha^-) / 2}}{\Delta^{\alpha^+}_{I(\alpha^+) + 1 /
2}}.\]</p><h2 id="Stream-function"><a class="docs-heading-anchor" href="#Stream-function">Stream function</a><a id="Stream-function-1"></a><a class="docs-heading-anchor-permalink" href="#Stream-function" title="Permalink"></a></h2><p>In 2D, the stream function is defined at the corners with the vorticity. Integrating the stream function Poisson equation over the vorticity volume yields</p><p class="math-container">\[\begin{split}
- \int_{\Omega_{I + \delta(1) / 2 + \delta(2) / 2}} \omega \, \mathrm{d} \Omega
&amp; = \int_{\Omega_{I + \delta(1) / 2 + \delta(2) / 2}} \nabla^2 \psi \,
\mathrm{d} \Omega \\
&amp; = \int_{\Gamma^1_{I + \delta(1) + \delta(2) / 2}} \frac{\partial \psi}{\partial x^1}
\, \mathrm{d} \Gamma
- \int_{\Gamma^1_{I + \delta(2) / 2}} \frac{\partial \psi}{\partial x^1}
\, \mathrm{d} \Gamma \\
&amp; + \int_{\Gamma^2_{I + \delta(1) / 2 + \delta(2)}} \frac{\partial \psi}{\partial x^2}
\, \mathrm{d} \Gamma
- \int_{\Gamma^2_{I + \delta(1) / 2}} \frac{\partial \psi}{\partial x^2}
\, \mathrm{d} \Gamma.
\end{split}\]</p><p>Replacing the integrals with the mid-point quadrature rule and the spatial derivatives with central finite differences yields the discrete Poisson equation for the stream function at the vorticity point:</p><p class="math-container">\[\begin{split}
\left| \Gamma^1_{I + \delta(1) / 2 + \delta(2) / 2} \right|
\left(
  \frac{\psi_{I + 3 / 2 \delta(1) + \delta(2) / 2} - \psi_{I + \delta(1) / 2 + \delta(2) / 2}}{x^1_{I(1) + 3 / 2} - x^1_{I(1) + 1 /2}}
- \frac{\psi_{I + \delta(1) / 2 + \delta(2) / 2} - \psi_{I - \delta(1) / 2 + \delta(2) / 2}}{x^1_{I(1) + 1 / 2} - x^1_{I(1) - 1 / 2}}
\right) &amp; + \\
\left| \Gamma^2_{I + \delta(1) / 2 + \delta(2) / 2} \right|
\left(
\frac{\psi_{I + \delta(1) / 2 + 3 / 2 \delta(2)} - \psi_{I + \delta(1) / 2 + \delta(2) / 2}}{x^2_{I(1) + 3 / 2} - x^2_{I(1) + 1 / 2}}
-\frac{\psi_{I + \delta(1) / 2 + \delta(2) / 2} - \psi_{I + \delta(1) / 2 - \delta(2) / 2}}{x^2_{I(2) + 1 / 2} - x^2_{I(2) - 1 / 2}}
\right) &amp; = \\
\left| \Omega_{I + \delta(1) / 2 + \delta(2) / 2} \right|
\omega_{I + \delta(1) / 2 + \delta(2) / 2} &amp;
\end{split}\]</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../ns/">« Incompressible Navier-Stokes equations</a><a class="docs-footer-nextpage" href="../time/">Time discretization »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="auto">Automatic (OS)</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.1.2 on <span class="colophon-date" title="Sunday 26 November 2023 23:10">Sunday 26 November 2023</span>. Using Julia version 1.9.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
