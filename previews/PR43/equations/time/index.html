<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Time discretization · IncompressibleNavierStokes.jl</title><meta name="title" content="Time discretization · IncompressibleNavierStokes.jl"/><meta property="og:title" content="Time discretization · IncompressibleNavierStokes.jl"/><meta property="twitter:title" content="Time discretization · IncompressibleNavierStokes.jl"/><meta name="description" content="Documentation for IncompressibleNavierStokes.jl."/><meta property="og:description" content="Documentation for IncompressibleNavierStokes.jl."/><meta property="twitter:description" content="Documentation for IncompressibleNavierStokes.jl."/><meta property="og:url" content="https://agdestein.github.io/IncompressibleNavierStokes.jl/equations/time/"/><meta property="twitter:url" content="https://agdestein.github.io/IncompressibleNavierStokes.jl/equations/time/"/><link rel="canonical" href="https://agdestein.github.io/IncompressibleNavierStokes.jl/equations/time/"/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.svg" alt="IncompressibleNavierStokes.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">IncompressibleNavierStokes.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><a class="tocitem" href="../../getting_started/">Getting Started</a></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../../generated/LidDrivenCavity2D/">Tutorial: Lid-Driven Cavity (2D)</a></li></ul></li><li><span class="tocitem">Equations</span><ul><li><a class="tocitem" href="../ns/">Incompressible Navier-Stokes equations</a></li><li><a class="tocitem" href="../spatial/">Spatial discretization</a></li><li class="is-active"><a class="tocitem" href>Time discretization</a><ul class="internal"><li><a class="tocitem" href="#Explicit-Runge-Kutta-methods"><span>Explicit Runge-Kutta methods</span></a></li><li><a class="tocitem" href="#Implicit-Runge-Kutta-methods"><span>Implicit Runge-Kutta methods</span></a></li><li><a class="tocitem" href="#Adams-Bashforth-Crank-Nicolson-method"><span>Adams-Bashforth Crank-Nicolson method</span></a></li><li><a class="tocitem" href="#One-leg-beta-method"><span>One-leg beta method</span></a></li></ul></li></ul></li><li><span class="tocitem">Features</span><ul><li><a class="tocitem" href="../../features/precision/">Floating point precision</a></li><li><a class="tocitem" href="../../features/gpu/">GPU Support</a></li><li><a class="tocitem" href="../../features/les/">Large eddy simulation</a></li><li><a class="tocitem" href="../../features/pressure/">Pressure solvers</a></li><li><a class="tocitem" href="../../features/bc/">Boundary conditions</a></li><li><a class="tocitem" href="../../features/steppers/">Time steppers</a></li></ul></li><li><span class="tocitem">API Reference</span><ul><li><a class="tocitem" href="../../api/api/">API</a></li><li><a class="tocitem" href="../../api/tableaux/">Runge-Kutta methods</a></li></ul></li><li><a class="tocitem" href="../../references/">References</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Equations</a></li><li class="is-active"><a href>Time discretization</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Time discretization</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/agdestein/IncompressibleNavierStokes.jl/blob/main/docs/src/equations/time.md#" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Time-discretization"><a class="docs-heading-anchor" href="#Time-discretization">Time discretization</a><a id="Time-discretization-1"></a><a class="docs-heading-anchor-permalink" href="#Time-discretization" title="Permalink"></a></h1><p>The spatially discretized Navier-Stokes equations form a differential-algebraic system, with an ODE for the velocity</p><p class="math-container">\[\frac{\mathrm{d} u_h}{\mathrm{d} t} = F(u_h, t) - (G p_h + y_G)\]</p><p>subject to the algebraic constraint formed by the mass equation</p><p class="math-container">\[M u_h + y_M = 0.\]</p><p>In the end of the <a href="../spatial/">previous section</a>, we differentiated the mass equation in time to obtain a discrete pressure Poisson equation. This equation includes the term <span>$\frac{\mathrm{d} y_M}{\mathrm{d} t}$</span>, which is non-zero if an unsteady flow of mass is added to the domain (Dirichlet boundary conditions). This term ensures that the time-continuous discrete velocity field <span>$u_h(t)$</span> stays divergence free (conserves mass). However, if we directly discretize this system in time, the mass preservation may actually not be respected. For this, we will change the definition of the pressure such that the time-discretized velocity field is divergence free at each time step and each time sub-step (to be defined in the following).</p><p>Consider the interval <span>$[0, T]$</span> for some simulation time <span>$T$</span>. We will divide it into <span>$N$</span> sub-intervals <span>$[t^n, t^{n + 1}]$</span> for <span>$n = 0, \dots, N - 1$</span>, with <span>$t^0 = 0$</span>, <span>$t^N = T$</span>, and increment <span>$\Delta t^n = t^{n + 1} - t^n$</span>. We define <span>$U^n \approx u_h(t^n)$</span> as an approximation to the exact discrete velocity field <span>$u_h(t^n)$</span>, with <span>$U^0 = u_h(0)$</span> starting from the exact initial conditions. We say that the time integration scheme (definition of <span>$U^n$</span>) is accurate to the order <span>$r$</span> if <span>$U^n = u_h(t^n) + \mathcal{O}(\Delta t^r)$</span> for all <span>$n$</span>.</p><h2 id="Explicit-Runge-Kutta-methods"><a class="docs-heading-anchor" href="#Explicit-Runge-Kutta-methods">Explicit Runge-Kutta methods</a><a id="Explicit-Runge-Kutta-methods-1"></a><a class="docs-heading-anchor-permalink" href="#Explicit-Runge-Kutta-methods" title="Permalink"></a></h2><p>See Sanderse <a href="../../references/#Sanderse2012">[2]</a>.</p><p>Consider the velocity field <span>$U_0$</span> at a certain time <span>$t_0$</span>. We will now perform one time step to <span>$t = t_0 + \Delta t$</span>. For explicit Runge-Kutta methods, this time step is divided into <span>$s$</span> sub-steps <span>$t_i = t_0 + \Delta t_i$</span> with increment <span>$\Delta t_i = c_i \Delta t$</span>. The final substep performs the full time step <span>$\Delta t_s = \Delta t$</span> such that <span>$t_s = t$</span>.</p><p>For <span>$i = 1, \dots, s$</span>, the intermediate velocity <span>$U_i$</span> and pressure <span>$P_i$</span> are computed as follows:</p><p class="math-container">\[\begin{split}
F_i &amp; = F(U_{i - 1}, t_{i - 1}) - y_G(t_{i - 1}) \\
V_i &amp; = U_0 + \Delta t \sum_{j = 1}^i a_{i j} F_j \\
L P_i &amp; = \frac{1}{c_i} \sum_{j = 1}^i a_{i j} F_j +
\frac{y_M(t_i) - y_M(t_0)}{\Delta t_i} \\
&amp; = \frac{(M V_i + y_M(t_i)) - (M U_0 + y_M(t_0))}{\Delta t_i^n} \\
&amp; = \frac{M V_i + y_M(t_i)}{\Delta t_i^n} \\
U_i &amp; = V_i - \Delta t_i G P_i,
\end{split}\]</p><p>where <span>$(a_{i j})_{i j}$</span> are the Butcher tableau coefficients of the RK-method, with the convention <span>$c_i = \sum_{j = 1}^i a_{i j}$</span>.</p><p>Finally, we set <span>$U = U_s$</span>. If <span>$U_0 = u_h(t_0)$</span>, we get the accuracy <span>$U = u_h(t) + \mathcal{O}(\Delta t^{r + 1})$</span>, where <span>$r$</span> is the order of the RK-method. If we perform <span>$n$</span> RK time steps instead of one, starting at exact initial conditions <span>$U^0 = u_h(0)$</span>, then <span>$U^n = u_h(t^n) + \mathcal{O}(\Delta t^r)$</span> for all <span>$n \in \{1, \dots, N\}$</span>. Note that for a given <span>$U$</span>, the corresponding pressure <span>$P$</span> can be calculated to the same accuracy as <span>$U$</span> by doing an additional pressure projection after each outer time step <span>$\Delta t$</span> (if we know <span>$\frac{\mathrm{d} y_M}{\mathrm{d} t}(t)$</span>), or to first order accuracy by simply taking <span>$P = P_s$</span>.</p><p>Note that each of the sub-step velocities <span>$U_i$</span> is divergence free, after projecting the tentative velocities <span>$V_i$</span>. This is ensured due to the judiciously chosen replacement of <span>$\frac{\mathrm{d} y_M}{\mathrm{d} t}(t_i)$</span> with <span>$(y_M(t_i) - y_M(t_0)) / \Delta t_i$</span>. The space-discrete divergence-freeness is thus perfectly preserved, even though the time discretization introduces other errors.</p><h2 id="Implicit-Runge-Kutta-methods"><a class="docs-heading-anchor" href="#Implicit-Runge-Kutta-methods">Implicit Runge-Kutta methods</a><a id="Implicit-Runge-Kutta-methods-1"></a><a class="docs-heading-anchor-permalink" href="#Implicit-Runge-Kutta-methods" title="Permalink"></a></h2><p>See Sanderse <a href="../../references/#Sanderse2013">[3]</a>.</p><h2 id="Adams-Bashforth-Crank-Nicolson-method"><a class="docs-heading-anchor" href="#Adams-Bashforth-Crank-Nicolson-method">Adams-Bashforth Crank-Nicolson method</a><a id="Adams-Bashforth-Crank-Nicolson-method-1"></a><a class="docs-heading-anchor-permalink" href="#Adams-Bashforth-Crank-Nicolson-method" title="Permalink"></a></h2><p>We here require that the time step <span>$\Delta t$</span> is constant. This methods uses Adams-Bashforth for the convective terms and Crank-Nicolson stepping for the diffusion and body force terms. Given the velocity field <span>$U_0 = u_h(t_0)$</span> at a time <span>$t_0$</span> and its previous value <span>$U_{-1} = u_h(t_0 - \Delta t)$</span> at the previous time <span>$t_{-1} = t_0 - \Delta t$</span>, the predicted velocity field <span>$U$</span> at the time <span>$t = t_0 + \Delta t$</span> is defined by first computing a tentative velocity:</p><p class="math-container">\[\begin{split}
\frac{V - U_0}{\Delta t}
&amp; = - (\alpha_0 C(U_0, t_0) + \alpha_{-1} C(U_{-1}, t_{-1})) \\
&amp; + \theta (D U_0 + y_D(t_0)) + (1 - \theta) (D V + y_D(t)) \\
&amp; + \theta f(t_0) + (1 - \theta) f(t) \\
&amp; - (G p_0 + y_G(t_0)),
\end{split}\]</p><p>where <span>$\theta \in [0, 1]$</span> is the Crank-Nicolson parameter (<span>$\theta = \frac{1}{2}$</span> for second order convergence), <span>$(\alpha_0, \alpha_{-1}) = \left( \frac{3}{2}, -\frac{1}{2} \right)$</span> are the Adams-Bashforth coefficients, and <span>$V$</span> is a tentative velocity yet to be made divergence free. We can group the terms containing <span>$V$</span> on the left hand side, to obtain</p><p class="math-container">\[\begin{split}
\left( \frac{1}{\Delta t} I - (1 - \theta) D \right) V
&amp; = \left(\frac{1}{\Delta t} I - \theta D \right) U_0 \\
&amp; - (\alpha_0 C(U_0, t_0) + \alpha_{-1} C(U_{-1}, t_{-1})) \\
&amp; + \theta y_D(t_0) + (1 - \theta) y_D(t) \\
&amp; + \theta f(t_0) + (1 - \theta) f(t) \\
&amp; - (G P_0 + y_G(t_0)).
\end{split}\]</p><p>We can compute <span>$V$</span> by inverting the positive definite matrix <span>$\left( \frac{1}{\Delta t} I - \theta D \right)$</span> for the given right hand side using a suitable linear solver. Assuming <span>$\Delta t$</span> is constant, we can precompute a Cholesky factorization of this matrix before starting time stepping.</p><p>We then compute the pressure difference <span>$\Delta P$</span> by solving</p><p class="math-container">\[L \Delta P = \frac{M V + y_M(t)}{\Delta t} - M (y_G(t) - y_G(t_0)),\]</p><p>after which a divergence free velocity <span>$U$</span> can be enforced:</p><p class="math-container">\[U = V - \Delta t (G \Delta P + y_G(t) - y_G(t_0)).\]</p><p>A first order accurate prediction of the corresponding pressure is <span>$P = P_0 + \Delta P$</span>. However, since this pressure is reused in the next time step, we perform an additional pressure solve to avoid accumulating first order errors. The resulting pressure <span>$P$</span> is then accurate to the same order as <span>$U$</span>.</p><h2 id="One-leg-beta-method"><a class="docs-heading-anchor" href="#One-leg-beta-method">One-leg beta method</a><a id="One-leg-beta-method-1"></a><a class="docs-heading-anchor-permalink" href="#One-leg-beta-method" title="Permalink"></a></h2><p>See Verstappen and Veldman <a href="../../references/#Verstappen2003">[5]</a> <a href="../../references/#Verstappen1997">[6]</a>.</p><p>We here require that the time step <span>$\Delta t$</span> is constant. Given the velocity <span>$U_0$</span> and pressure <span>$P_0$</span> at the current time <span>$t_0$</span> and their previous values <span>$U_{-1}$</span> and <span>$P_{-1}$</span> at the time <span>$t_{-1} = t_0 - \Delta t$</span>, we start by computing the &quot;offstep&quot; values <span>$V = (1 + \beta) V_0 - \beta V_{-1}$</span> and <span>$Q = (1 + \beta) P_0 - \beta P_{-1}$</span> for some <span>$\beta = \frac{1}{2}$</span>.</p><p>A tentative velocity field <span>$W$</span> is then computed as follows:</p><p class="math-container">\[W = \frac{1}{\beta + \frac{1}{2}} \left( 2 \beta U_0 - \left( \beta -
\frac{1}{2} \right) U_{-1} + \Delta t F(V, t) - \Delta t
(G Q + y_G(t)) \right).\]</p><p>A pressure correction <span>$\Delta P$</span> is obtained by solving the Poisson equation</p><p class="math-container">\[L \Delta P = \frac{\beta + \frac{1}{2}}{\Delta t} (M W + y_M(t)).\]</p><p>Finally, the divergence free velocity field is given by</p><p class="math-container">\[U = W - \frac{\Delta t}{\beta + \frac{1}{2}} G \Delta P,\]</p><p>while the second order accurate pressure is given by</p><p class="math-container">\[P = 2 P_0 - P_{-1} + \frac{4}{3} \Delta P.\]</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../spatial/">« Spatial discretization</a><a class="docs-footer-nextpage" href="../../features/precision/">Floating point precision »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="auto">Automatic (OS)</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.1.1 on <span class="colophon-date" title="Thursday 19 October 2023 12:54">Thursday 19 October 2023</span>. Using Julia version 1.9.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
